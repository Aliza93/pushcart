!!!
%html{xmlns: "http://www.w3.org/1999/xhtml"}
  %head
    %meta{content: "text/html; charset=utf-8", "http-equiv" => "Content-Type"}/
    %meta{content: "width=device-width, initial-scale=1.0", name: "viewport"}/
    %title Your weekly Pushcart report
    /[if gte mso 6]
      <style>
      table.mcnFollowContent {width:100% !important;}
      table.mcnShareContent {width:100% !important;}
      </style>
  %body{bottommargin: "0", leftmargin: "0", rightmargin: "0", topmargin: "0"}
    %table{bgcolor: "#333333", border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
      %tr
        %td{align: "center", bgcolor: "#333333", valign: "top"}
          %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
            %tr
              %td{height: "25"}
          %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
            %tr
              %td{align: "center", height: "auto", valign: "top"}
                %table.table800{bgcolor: "#70BF41", border: "0", cellpadding: "0", cellspacing: "0", width: "700"}
                  %tr
                    %td{align: "center", height: "auto", valign: "top"}
                      %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                        %tr
                          %td{height: "30"}
                      %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                        %tr
                          %td{align: "center", height: "25", valign: "top"}
                            %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600px"}
                              %tr
                                %td.columnsContainer000{align: "right", style: "font-size:75px; color:#FFF; font-family:Ubuntu; font-weight:bold; font-stretch:normal; font-variant:normal !important;", valign: "bottom", width: "420"} Pushcart
                                %td{align: "left", width: "180"}
                                  %img.logo{alt: "", height: "122", src: "https://gallery.mailchimp.com/388326f4e8f2ac883f689d7e7/images/e87fc743-48e8-4ae6-8617-ce7d043660b8.png", width: "128"}/
                      %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                        %tr
                          %td{height: "25"}
                      %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                        %tr
                          %td{align: "center", valign: "top"}
                            %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                              %tr
                                %td{align: "center", style: "color:#FFF; font-family: Roboto; font-weight:bold; font-size:38px; line-height:150%", valign: "top"}
                                  = "#{@digest.start_date.strftime("%B %-d")} - #{@digest.end_date.strftime("%B %-d")}"
                      %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                        %tr
                          %td{height: "25"}
                      %table{bgcolor: "#FFFFFF", border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                        %tr
                          %td{align: "center", bgcolor: "#FFFFFF", height: "auto", valign: "top"}
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{height: "20"}
                            %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                              %tr
                                %td{align: "center", style: "color:#70BF41; font-family:Roboto; font-size:68px; font-stretch:normal; font-variant:normal; font-weight:bold;", valign: "top"} Your Mission
                            %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                              %tr
                                %td{align: "center", valign: "top"}
                                  %img.img2{height: "22", src: "https://gallery.mailchimp.com/388326f4e8f2ac883f689d7e7/images/3fdca783-baab-4b65-bb49-5a03ae35717d.png", style: " border:none;", width: "325"}/
                            %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                              %tr
                                %td{align: "center", height: "20", valign: "top"}
                            %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                              %tr
                                %td{align: "center", style: "color:#70BF41; line-height:150%; font-size:38px; font-family:Roboto; font-weight:bold;", valign: "top"}
                                  - if @user.mission.nil?
                                    You still need to set a mission!
                                    = link_to 'Please do so here.', url_with_login_token(@user, edit_household_url)
                                  - else
                                    = simple_format @user.mission.name
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{height: "20"}
                      %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                        %tr
                          %td{height: "20"}
                      %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                        %tr
                          %td{align: "center", height: "auto", valign: "top"}
                            %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                              %tr
                                %td{align: "center", style: "color: #FFF; font-family:Roboto; font-size:68px; font-stretch:normal; font-variant:normal; font-weight:bold;", valign: "top"} Your Cart
                            %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                              %tr
                                %td{align: "center", valign: "top"}
                                  %img.img2{height: "30", src: "https://gallery.mailchimp.com/388326f4e8f2ac883f689d7e7/images/ca9bb29f-be85-4b71-bb67-8784c828e760.png", style: "border:none;", width: "527"}/
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{height: "20"}
                            %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                              %tr
                                %td.columnsContainer{align: "center", valign: "top"}
                                  %table{border: "0", cellpadding: "0", cellspacing: "0", width: "150"}
                                    %tr
                                      %td{align: "center", background: "https://gallery.mailchimp.com/388326f4e8f2ac883f689d7e7/images/ff2edc22-8126-4d58-b72e-43af6ac0620c.png", bgcolor: "#70BF41", height: "150", valign: "middle", width: "150"}
                                        /[if gte mso 9]
                                          <v:rect xmlns:v="urn:schemas-microsoft-com:vml" fill="true" stroke="false" style="width:150px;height:150px;">
                                          <v:fill type="tile" src="https://gallery.mailchimp.com/388326f4e8f2ac883f689d7e7/images/ff2edc22-8126-4d58-b72e-43af6ac0620c.png" color="#70BF41" />
                                          <v:textbox inset="0,0,0,0">
                                        %div{style: "color:#70BF41; font-family:Roboto; font-size:28px; font-weight:bold;"}= "#{@digest.items.count} Items"
                                        /[if gte mso 9]
                                          </v:textbox>
                                          </v:rect>
                                  %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                                    %tr
                                      %td
                                %td.columnsContainer{align: "center", valign: "top"}
                                  %table{border: "0", cellpadding: "0", cellspacing: "0", width: "150"}
                                    %tr
                                      %td{align: "center", background: "https://gallery.mailchimp.com/388326f4e8f2ac883f689d7e7/images/ff2edc22-8126-4d58-b72e-43af6ac0620c.png", bgcolor: "#70BF41", height: "150", valign: "middle", width: "150"}
                                        /[if gte mso 9]
                                          <v:rect xmlns:v="urn:schemas-microsoft-com:vml" fill="true" stroke="false" style="width:150px;height:150px;">
                                          <v:fill type="tile" src="https://gallery.mailchimp.com/388326f4e8f2ac883f689d7e7/images/ff2edc22-8126-4d58-b72e-43af6ac0620c.png" color="#70BF41" />
                                          <v:textbox inset="0,0,0,0">
                                        %div{style: "color:#70BF41; font-family:Roboto; font-size:28px; font-weight:bold;"}= number_to_currency(@digest.total_price)
                                        /[if gte mso 9]
                                          </v:textbox>
                                          </v:rect>
                                  %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                                    %tr
                                      %td
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{height: "20"}
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{align: "center", valign: "top"}
                                  %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                                    %tr
                                      %td{align: "center", style: "color:#FFF; font-family: Roboto; font-weight:bold; font-size:32px; line-height:150%", valign: "top"} Food Group Breakdown (# of servings)
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{height: "25"}
                            - @digest.categories_breakdown.each do |cat, cat_hash|
                              - if CategoryDigester.ruminate.include? cat
                                - band_width = (cat_hash[:servings].to_f/@digest.categories_breakdown[:servings_max].to_f)*100
                                %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                                  %tr
                                    %td{align: "center", height: "60", valign: "top"}
                                      %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                                        %tr
                                          %td
                                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                                              %tr
                                                %td.columnsContainer30{align: "right", height: "50", style: "font-size:16px; font-family:Roboto; color:#FFF; font-weight:bold;", valign: "middle", width: "19%"}= cat.to_s
                                                %td{align: "left", height: "50", valign: "top", width: "12%"}
                                                  %img{height: "50", src: "#{ASSETS_URL_ROOT}/weekly_digest/#{cat.to_s}.png", width: "68"}/
                                                %td{align: "left", height: "50", valign: "top", width: "69%"}
                                                  %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                                                    %tr
                                                      %td{align: "left", height: "50", valign: "top", width: "80%"}
                                                        %table{border: "0", cellpadding: "0", cellspacing: "0", width: "#{band_width.to_i}%"}
                                                          %tr
                                                            - if cat_hash[:servings] == 0
                                                              %td{align: "center", bgcolor: "#70BF41", height: "50", style: "color:#FFFFFF; font-family:Roboto; font-size:17px; font-weight:bold;", valign: "middle"}= "0"
                                                            - else 
                                                              %td{align: "center", bgcolor: "#FFFFFF", height: "50", style: "color:#70BF41; font-family:Roboto; font-size:17px; font-weight:bold;", valign: "middle"}= "#{cat_hash[:servings].to_i}"
                                                      - if false 
                                                        %td{align: "left", height: "50", valign: "top", width: "20%"}
                                                          %img.img4{height: "50", src: "https://gallery.mailchimp.com/388326f4e8f2ac883f689d7e7/images/107b3d8a-6b73-46a9-a6bd-34206be2d98a.png", width: "72"}/
                                                        %td{align: "right", style: "font-size:18px; font-family: Roboto; color:#FFF; font-weight:bold;", valign: "middle", width: "73%"} +7% from last week

                                                        %td{align: "left", height: "50", valign: "top", width: "12%"}
                                                          %img{height: "50", src: "https://gallery.mailchimp.com/388326f4e8f2ac883f689d7e7/images/6e64d283-9316-42b2-83e9-9491918e5580.png", width: "39"}/
                                                        %td{align: "left", height: "50", style: "font-size:18px; font-family: Roboto; color:#FFF; font-weight:bold;", valign: "middle", width: "58%"} -5% from last week
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{height: "20"}
                      %table{bgcolor: "#FFFFFF", border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                        %tr
                          %td{align: "center", bgcolor: "#FFFFFF", valign: "top"}
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{height: "35"}
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{align: "center", valign: "bottom"}
                                  %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                                    %tr
                                      %td{align: "center", style: "color:#70BF41; line-height:150%; font-size:38px; font-family:Roboto; font-weight:bold;", valign: "bottom"} #
                                      %td{align: "center", style: "color:#70BF41; line-height:150%; font-size:38px; font-family:Roboto; font-weight:bold;", valign: "bottom"} Servings
                                      %td{align: "center", style: "color:#70BF41; line-height:150%; font-size:38px; font-family:Roboto; font-weight:bold;", valign: "bottom"} Name
                                      %td{align: "center", style: "color:#70BF41; line-height:150%; font-size:38px; font-family:Roboto; font-weight:bold;", valign: "bottom"} $
                            %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                              %tr
                                %td{height: "20"}
                      - @digest.items_with_categories.each do |cat, items|
                        - unless items.empty?
                          %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                            %tr
                              %td{align: "center", valign: "top"}
                                %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                                  %tr
                                    %td{height: "20"}
                                %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                                  %tr
                                    %td{align: "left", valign: "top"}
                                      %table{border: "0", cellpadding: "0", cellspacing: "0", width: "176"}
                                        %tr
                                          %td{align: "left", style: "color:#FFF; font-family: Roboto; font-weight:bold; font-size:32px; font-stretch:normal; font-variant:normal;"}= cat.to_s
                                          %td{align: "left"}
                                            %img{height: "52", src: "#{ASSETS_URL_ROOT}/weekly_digest/#{cat.to_s}.png", width: "52"}/
                                - items.each do |item|
                                  %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                                    %tr
                                      %td{height: "20"}
                                  %table.table-inner{border: "0", cellpadding: "0", cellspacing: "0", width: "600"}
                                    %tr
                                      %td.columnsContainer2{align: "center", style: "color:#FFF; font-family: Roboto; font-weight:bold; font-size:32px; ", width: "122"}= beautify_numerical_output(item.quantity)
                                      %td.columnsContainer2{align: "center", style: "color:#FFF; font-family: Roboto; font-weight:bold; font-size:32px; ", width: "122"}= beautify_numerical_output(item.servings_total, true)
                                      %td.columnsContainer2{align: "center", style: "color:#FFF; font-family: Roboto; font-weight:bold; font-size:32px; ", width: "352"}= item.name
                                      %td.columnsContainer2{align: "center", style: "color:#FFF; font-family: Roboto; font-weight:bold; font-size:32px;", width: "126"}= number_to_currency(item.total_price)
                                  %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
                                    %tr
                                      %td{height: "25"}
          %table{border: "0", cellpadding: "0", cellspacing: "0", width: "100%"}
            %tr
              %td{height: "25"}